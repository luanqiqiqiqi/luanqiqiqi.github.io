<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Fast HLS Video</title>
    <style>
        *{margin:0;padding:0;}
        html,body{width:100%;height:100%;overflow:hidden;}
        #v{width:100vw;height:100vh;object-fit:cover;pointer-events:none;}
        body{touch-action:none;-webkit-touch-callout:none;}
    </style>
    <!-- 加载最轻量的hls.js，提速加载 -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.14/dist/hls.light.min.js"></script>
</head>
<body onclick="playVideo()">
    <video id="v" autoplay muted loop playsinline></video>

    <script>
        const v = document.getElementById('v');
        // 初始化HLS播放（适配你的仓库地址）
        function initHLS() {
            if (Hls.isSupported()) {
                const hls = new Hls({
                    maxBufferLength: 2,    // 仅缓存2秒切片，秒开播放
                    maxMaxBufferLength: 4, // 最大缓存4秒，避免卡顿
                    startLevel: 0,         // 优先加载最低码率，最快启动
                    enableWorker: true,    // 开启WebWorker解码，不卡主线程
                    lowLatencyMode: true   // 低延迟模式，极致提速
                });
                // 你的仓库CDN地址（已适配）
                hls.loadSource('https://cdn.jsdelivr.net/gh/luanqiqiqi/luanqiqiqi.github.io/video.m3u8');
                hls.attachMedia(v);
                // 解析完成立即播放，无等待
                hls.on(Hls.Events.MANIFEST_PARSED, () => v.play());
                // 网络错误自动重试
                hls.on(Hls.Events.ERROR, (e, data) => {
                    if (data.fatal && data.type === Hls.ErrorTypes.NETWORK_ERROR) {
                        hls.startLoad();
                    }
                });
            } else if (v.canPlayType('application/vnd.apple.mpegurl')) {
                // Safari/iOS原生HLS支持
                v.src = 'https://cdn.jsdelivr.net/gh/luanqiqiqi/luanqiqiqi.github.io/video.m3u8';
                v.addEventListener('loadedmetadata', () => v.play());
            }
        }

        // 点击任意位置解锁声音+强制播放（无法暂停）
        function playVideo() {
            v.play();
            v.muted = false;
        }

        // 拦截所有暂停/停止行为，确保无法手动关闭
        v.addEventListener('pause', () => v.play());
        v.addEventListener('ended', () => v.play());
        v.addEventListener('waiting', () => v.play());

        // 页面加载立即初始化，无延迟
        window.onload = initHLS;
    </script>
</body>
</html>
